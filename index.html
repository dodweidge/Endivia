<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Macintosh (System 1) Mock</title>
  <style>
    :root{
      --scale: 1.0;                 /* 你可以改成 1.5 / 2.0 */
      --ui: 12px;                   /* 基础字号（会再乘 scale） */
      --barH: calc(22px * var(--scale));
      --winBorder: 2px;
      --bw: #000;
      --paper: #fff;
      --desk1: #e9e9e9;
      --desk2: #d9d9d9;
      --shadow: rgba(0,0,0,.35);
      --z: 10;
      --focus: #000;
      --inactive: rgba(0,0,0,.45);
      --sel: #000;
      --selText: #fff;
    }

    *{ box-sizing: border-box; }
    html,body{ height: 100%; }
    body{
      margin:0;
      background:
        /* 经典灰色抖动(dither)桌面 */
        repeating-linear-gradient(45deg, var(--desk1) 0 2px, var(--desk2) 2px 4px);
      font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
      color: var(--bw);
      overflow: hidden;
      user-select: none;
    }

    /* 顶部菜单栏 */
    .menubar{
      position: fixed;
      left: 0; right: 0; top: 0;
      height: var(--barH);
      background: var(--paper);
      border-bottom: var(--winBorder) solid var(--bw);
      display: flex;
      align-items: center;
      padding: 0 calc(8px * var(--scale));
      gap: calc(10px * var(--scale));
      z-index: 9999;
      font-size: calc(var(--ui) * var(--scale));
      line-height: 1;
    }
    .menu-left, .menu-right{
      display:flex; align-items:center; gap: calc(10px * var(--scale));
    }
    .menu-right{ margin-left: auto; gap: calc(12px * var(--scale)); }
    .apple{
      width: calc(16px * var(--scale));
      height: calc(16px * var(--scale));
      border: var(--winBorder) solid var(--bw);
      display: grid;
      place-items: center;
      font-weight: 700;
      font-size: calc(12px * var(--scale));
      cursor: pointer;
    }
    .menu-item{
      padding: calc(3px * var(--scale)) calc(6px * var(--scale));
      cursor: pointer;
      border: 1px solid transparent;
    }
    .menu-item.active{
      background: var(--bw);
      color: var(--paper);
    }

    /* 下拉菜单 */
    .dropdown{
      position: fixed;
      top: calc(var(--barH) - 1px);
      min-width: calc(180px * var(--scale));
      background: var(--paper);
      border: var(--winBorder) solid var(--bw);
      box-shadow: 0 calc(8px * var(--scale)) 0 var(--shadow);
      display: none;
      z-index: 9998;
      font-size: calc(var(--ui) * var(--scale));
    }
    .dropdown .row{
      display:flex;
      justify-content: space-between;
      align-items:center;
      padding: calc(6px * var(--scale)) calc(10px * var(--scale));
      border-bottom: 1px solid rgba(0,0,0,.2);
      cursor:pointer;
    }
    .dropdown .row:last-child{ border-bottom:0; }
    .dropdown .row:hover{
      background: var(--bw);
      color: var(--paper);
    }
    .kbd{ opacity:.75; margin-left: calc(12px * var(--scale)); }

    /* 桌面区域（留出菜单栏高度） */
    .desktop{
      position: fixed;
      left: 0; right: 0;
      top: var(--barH);
      bottom: 0;
      padding: calc(14px * var(--scale));
    }

    /* 图标 */
    .icon{
      position: absolute;
      width: calc(76px * var(--scale));
      text-align: center;
      cursor: default;
    }
    .icon .glyph{
      width: calc(36px * var(--scale));
      height: calc(36px * var(--scale));
      margin: 0 auto calc(6px * var(--scale));
      border: var(--winBorder) solid var(--bw);
      background: var(--paper);
      display:grid;
      place-items:center;
    }
    .icon .label{
      display:inline-block;
      padding: calc(2px * var(--scale)) calc(4px * var(--scale));
      font-size: calc(var(--ui) * var(--scale));
      line-height: 1.15;
      background: transparent;
      color: var(--bw);
    }
    .icon.selected .label{
      background: var(--sel);
      color: var(--selText);
    }

    /* 窗口 */
    .window{
      position: absolute;
      background: var(--paper);
      border: var(--winBorder) solid var(--bw);
      box-shadow: 0 calc(10px * var(--scale)) 0 var(--shadow);
      min-width: calc(260px * var(--scale));
      min-height: calc(140px * var(--scale));
      display: none;
    }
    .window.visible{ display:block; }
    .titlebar{
      height: calc(22px * var(--scale));
      border-bottom: var(--winBorder) solid var(--bw);
      display:flex;
      align-items:center;
      gap: calc(8px * var(--scale));
      padding: 0 calc(8px * var(--scale));
      cursor: move;
      background:
        /* 经典标题栏虚线感 */
        repeating-linear-gradient(90deg, transparent 0 6px, rgba(0,0,0,.14) 6px 7px);
    }
    .window.inactive .titlebar{
      opacity: .75;
      filter: grayscale(1);
    }
    .closebox{
      width: calc(14px * var(--scale));
      height: calc(14px * var(--scale));
      border: var(--winBorder) solid var(--bw);
      background: var(--paper);
      cursor: pointer;
      flex: 0 0 auto;
      display:grid;
      place-items:center;
      font-size: calc(10px * var(--scale));
      line-height: 1;
    }
    .wintitle{
      flex: 1 1 auto;
      text-align:center;
      font-size: calc(var(--ui) * var(--scale));
      letter-spacing: 0.02em;
      font-weight: 700;
      padding-right: calc(18px * var(--scale)); /* 平衡 closebox */
    }
    .content{
      position: relative;
      padding: calc(10px * var(--scale));
      font-size: calc(var(--ui) * var(--scale));
      line-height: 1.35;
    }

    /* 简单“经典”滚动条造型（装饰） */
    .scrollframe{
      display:grid;
      grid-template-columns: 1fr calc(16px * var(--scale));
      gap: 0;
      border: var(--winBorder) solid var(--bw);
      background: var(--paper);
      height: calc(220px * var(--scale));
    }
    .scrollframe .pane{
      padding: calc(10px * var(--scale));
      overflow: auto;
      user-select: text;
    }
    .scrollframe .bar{
      border-left: var(--winBorder) solid var(--bw);
      background:
        repeating-linear-gradient(45deg, #fff 0 2px, #eee 2px 4px);
      position: relative;
    }
    .scrollframe .thumb{
      position:absolute;
      left: 2px; right: 2px;
      top: calc(22px * var(--scale));
      height: calc(44px * var(--scale));
      border: var(--winBorder) solid var(--bw);
      background: var(--paper);
    }

    /* Finder 列表 */
    .list{
      border: var(--winBorder) solid var(--bw);
      padding: calc(8px * var(--scale));
      background: var(--paper);
    }
    .list .item{
      display:flex; justify-content: space-between; gap: calc(8px * var(--scale));
      padding: calc(4px * var(--scale)) calc(6px * var(--scale));
      cursor: default;
    }
    .list .item:hover{
      background: var(--bw);
      color: var(--paper);
    }
    .muted{ opacity: .7; }

    /* 对话框 */
    .dialog{
      width: calc(360px * var(--scale));
    }
    .dialog .content{
      padding: calc(12px * var(--scale));
    }
    .btnrow{
      display:flex; justify-content:flex-end; gap: calc(8px * var(--scale));
      margin-top: calc(10px * var(--scale));
    }
    .btn{
      border: var(--winBorder) solid var(--bw);
      background: var(--paper);
      padding: calc(6px * var(--scale)) calc(10px * var(--scale));
      cursor: pointer;
      font-size: calc(var(--ui) * var(--scale));
    }
    .btn:active{ transform: translateY(1px); }

    /* “桌面”点击取消选中/关闭菜单 */
    .overlay-capture{
      position: fixed;
      left:0; right:0; top:0; bottom:0;
      z-index: 1;
      pointer-events: none;
    }

    /* 小提示 */
    .hint{
      position: fixed;
      left: calc(14px * var(--scale));
      bottom: calc(12px * var(--scale));
      font-size: calc(11px * var(--scale));
      opacity: .75;
      z-index: 2;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(0,0,0,.25);
      padding: calc(6px * var(--scale)) calc(8px * var(--scale));
    }
    .hint code{ background: #fff; border: 1px solid #000; padding: 1px 4px; }

    /* 可选：大屏模式（由菜单切换） */
    body.big { --scale: 1.6; }
    body.huge { --scale: 2.0; }
  </style>
</head>
<body>
  <!-- MENU BAR -->
  <div class="menubar" id="menubar">
    <div class="menu-left">
      <div class="apple" id="appleBtn" title=""></div>
      <div class="menu-item" data-menu="file">File</div>
      <div class="menu-item" data-menu="edit">Edit</div>
      <div class="menu-item" data-menu="view">View</div>
      <div class="menu-item" data-menu="special">Special</div>
    </div>
    <div class="menu-right">
      <div class="muted" id="clock">--:--</div>
    </div>
  </div>

  <!-- DROPDOWNS -->
  <div class="dropdown" id="dd-apple">
    <div class="row" data-action="about">About the Macintosh…</div>
    <div class="row" data-action="sep" style="pointer-events:none; opacity:.6;">────────────</div>
    <div class="row" data-action="openFinder">Open Finder</div>
    <div class="row" data-action="openNote">Open Note Pad</div>
  </div>

  <div class="dropdown" id="dd-file">
    <div class="row" data-action="openFinder">Open</div>
    <div class="row" data-action="openNote">New Note</div>
    <div class="row" data-action="sep" style="pointer-events:none; opacity:.6;">────────────</div>
    <div class="row" data-action="closeFront">Close <span class="kbd">⌘W</span></div>
  </div>

  <div class="dropdown" id="dd-edit">
    <div class="row" data-action="beep">Undo <span class="kbd">⌘Z</span></div>
    <div class="row" data-action="beep">Cut <span class="kbd">⌘X</span></div>
    <div class="row" data-action="beep">Copy <span class="kbd">⌘C</span></div>
    <div class="row" data-action="beep">Paste <span class="kbd">⌘V</span></div>
  </div>

  <div class="dropdown" id="dd-view">
    <div class="row" data-action="scaleNormal">Normal Size</div>
    <div class="row" data-action="scaleBig">Big Screen</div>
    <div class="row" data-action="scaleHuge">Huge Screen</div>
  </div>

  <div class="dropdown" id="dd-special">
    <div class="row" data-action="beep">Clean Up Desktop</div>
    <div class="row" data-action="sep" style="pointer-events:none; opacity:.6;">────────────</div>
    <div class="row" data-action="restart">Restart…</div>
    <div class="row" data-action="shutdown">Shut Down…</div>
  </div>

  <div class="overlay-capture" id="capture"></div>

  <!-- DESKTOP -->
  <div class="desktop" id="desktop">
    <!-- Icons -->
    <div class="icon" id="icon-hd" data-open="finder" style="left: 24px; top: 24px;">
      <div class="glyph" aria-hidden="true">
        <!-- Simple 1-bit disk SVG -->
        <svg width="100%" height="100%" viewBox="0 0 36 36" shape-rendering="crispEdges">
          <rect x="6" y="6" width="24" height="24" fill="#fff" stroke="#000" stroke-width="2"/>
          <rect x="10" y="10" width="16" height="8" fill="#fff" stroke="#000" stroke-width="2"/>
          <rect x="10" y="22" width="16" height="6" fill="#fff" stroke="#000" stroke-width="2"/>
          <rect x="13" y="24" width="3" height="2" fill="#000"/>
          <rect x="20" y="24" width="3" height="2" fill="#000"/>
        </svg>
      </div>
      <div class="label">Macintosh HD</div>
    </div>

    <div class="icon" id="icon-note" data-open="note" style="left: 24px; top: 122px;">
      <div class="glyph" aria-hidden="true">
        <svg width="100%" height="100%" viewBox="0 0 36 36" shape-rendering="crispEdges">
          <rect x="8" y="6" width="20" height="24" fill="#fff" stroke="#000" stroke-width="2"/>
          <rect x="10" y="10" width="16" height="2" fill="#000"/>
          <rect x="10" y="14" width="16" height="2" fill="#000"/>
          <rect x="10" y="18" width="12" height="2" fill="#000"/>
          <rect x="10" y="22" width="14" height="2" fill="#000"/>
        </svg>
      </div>
      <div class="label">Note Pad</div>
    </div>

    <div class="icon" id="icon-trash" data-open="trash" style="right: 22px; top: 24px;">
      <div class="glyph" aria-hidden="true">
        <svg width="100%" height="100%" viewBox="0 0 36 36" shape-rendering="crispEdges">
          <rect x="12" y="10" width="12" height="20" fill="#fff" stroke="#000" stroke-width="2"/>
          <rect x="10" y="10" width="16" height="4" fill="#fff" stroke="#000" stroke-width="2"/>
          <rect x="14" y="14" width="2" height="14" fill="#000"/>
          <rect x="20" y="14" width="2" height="14" fill="#000"/>
        </svg>
      </div>
      <div class="label">Trash</div>
    </div>
  </div>

  <!-- WINDOWS -->
  <div class="window visible" id="win-finder" style="left: 140px; top: 80px; width: 520px;">
    <div class="titlebar">
      <div class="closebox" data-close="win-finder">×</div>
      <div class="wintitle">Finder</div>
    </div>
    <div class="content">
      <div class="scrollframe">
        <div class="pane">
          <div class="muted">Macintosh HD</div>
          <div style="height:8px"></div>
          <div class="list" id="finderList">
            <div class="item" data-open="about"><span>System Folder</span><span class="muted">Folder</span></div>
            <div class="item" data-open="note"><span>Note Pad</span><span class="muted">Application</span></div>
            <div class="item" data-open="about"><span>Read Me</span><span class="muted">Text</span></div>
            <div class="item" data-open="about"><span>Paint</span><span class="muted">Application</span></div>
            <div class="item" data-open="about"><span>Calculator</span><span class="muted">Application</span></div>
          </div>
          <div style="height:14px"></div>
          <div class="muted">
            Tip: 双击桌面图标，或在菜单里打开窗口。
          </div>
        </div>
        <div class="bar" aria-hidden="true">
          <div class="thumb"></div>
        </div>
      </div>
    </div>
  </div>

  <div class="window" id="win-note" style="left: 220px; top: 140px; width: 520px; height: 340px;">
    <div class="titlebar">
      <div class="closebox" data-close="win-note">×</div>
      <div class="wintitle">Note Pad</div>
    </div>
    <div class="content" style="height: calc(100% - 22px * var(--scale));">
      <div class="scrollframe" style="height: calc(100% - 4px);">
        <div class="pane" style="padding:0; overflow:hidden;">
          <textarea id="noteArea" style="
            width:100%; height:100%;
            border:0; outline:none;
            padding: calc(10px * var(--scale));
            resize:none;
            font: inherit;
            font-size: calc(var(--ui) * var(--scale));
            line-height:1.45;
            background: transparent;
            color:#000;
          ">Welcome to Macintosh.

This is a mock of System 1-ish UI.
Try:
- Drag windows by the title bar
- Click menus
- Double-click icons
- Press ⌘W to close front window

(You can type here.)</textarea>
        </div>
        <div class="bar" aria-hidden="true"><div class="thumb"></div></div>
      </div>
    </div>
  </div>

  <div class="window dialog" id="win-about" style="left: 260px; top: 120px;">
    <div class="titlebar">
      <div class="closebox" data-close="win-about">×</div>
      <div class="wintitle">About the Macintosh</div>
    </div>
    <div class="content">
      <div style="display:flex; gap:12px; align-items:flex-start;">
        <div style="width:64px; height:64px; border:var(--winBorder) solid #000; background:#fff; display:grid; place-items:center;">
          <div style="font-weight:700; font-size: calc(26px * var(--scale));"></div>
        </div>
        <div>
          <div style="font-weight:700; margin-bottom:6px;">Macintosh</div>
          <div class="muted">System 1 UI mock (HTML/CSS/JS)</div>
          <div style="height:8px"></div>
          <div>Memory: 128K (pretend)</div>
          <div>Display: 512×342 (pretend)</div>
        </div>
      </div>
      <div class="btnrow">
        <button class="btn" data-action="closeAbout">OK</button>
      </div>
    </div>
  </div>

  <div class="window dialog" id="win-trash" style="left: 360px; top: 160px;">
    <div class="titlebar">
      <div class="closebox" data-close="win-trash">×</div>
      <div class="wintitle">Trash</div>
    </div>
    <div class="content">
      <div class="muted">Trash is empty.</div>
      <div class="btnrow">
        <button class="btn" data-close="win-trash">Close</button>
      </div>
    </div>
  </div>

  <div class="hint">
    双击图标打开 · 拖拽窗口 · 菜单栏可用 · 快捷键 <code>⌘W</code> 关闭前台窗口
  </div>

  <script>
    // ---------------------------
    // Minimal System-1-ish Window Manager
    // ---------------------------
    const $ = (sel, root=document) => root.querySelector(sel);
    const $$ = (sel, root=document) => [...root.querySelectorAll(sel)];
    const desktop = $("#desktop");
    const menubar = $("#menubar");

    let zTop = 50;
    let frontWin = null;
    let activeMenu = null;

    // Clock
    function pad(n){ return String(n).padStart(2,"0"); }
    setInterval(() => {
      const d = new Date();
      $("#clock").textContent = `${pad(d.getHours())}:${pad(d.getMinutes())}`;
    }, 500);

    // Beep (tiny)
    function beep(){
      try{
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const o = ctx.createOscillator();
        const g = ctx.createGain();
        o.type = "square"; o.frequency.value = 740;
        g.gain.value = 0.03;
        o.connect(g); g.connect(ctx.destination);
        o.start();
        setTimeout(() => { o.stop(); ctx.close(); }, 90);
      }catch(e){ /* ignore */ }
    }

    function setFront(win){
      if(!win) return;
      $$(".window").forEach(w => w.classList.add("inactive"));
      win.classList.remove("inactive");
      zTop += 1;
      win.style.zIndex = zTop;
      frontWin = win;
    }

    function showWin(id){
      const win = document.getElementById(id);
      if(!win) return;
      win.classList.add("visible");
      setFront(win);
    }

    function hideWin(id){
      const win = document.getElementById(id);
      if(!win) return;
      win.classList.remove("visible");
      if(frontWin === win) frontWin = null;
      // bring any other visible window to front
      const vis = $$(".window.visible");
      if(vis.length) setFront(vis[vis.length-1]);
    }

    // Window dragging
    let drag = null;
    function onPointerDownTitle(e){
      const title = e.currentTarget;
      const win = title.closest(".window");
      // Don't start drag if clicked closebox
      if(e.target.closest(".closebox")) return;
      setFront(win);

      const rect = win.getBoundingClientRect();
      drag = {
        win,
        startX: e.clientX,
        startY: e.clientY,
        origL: rect.left,
        origT: rect.top
      };
      win.setPointerCapture?.(e.pointerId);
    }
    function onPointerMove(e){
      if(!drag) return;
      const dx = e.clientX - drag.startX;
      const dy = e.clientY - drag.startY;
      // Keep within viewport (roughly)
      const left = Math.max(6, drag.origL + dx);
      const top  = Math.max(parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--barH')) + 6, drag.origT + dy);
      drag.win.style.left = left + "px";
      drag.win.style.top  = top + "px";
    }
    function onPointerUp(){
      drag = null;
    }

    $$(".window .titlebar").forEach(tb => {
      tb.addEventListener("pointerdown", onPointerDownTitle);
    });
    window.addEventListener("pointermove", onPointerMove);
    window.addEventListener("pointerup", onPointerUp);

    // Close buttons
    $$(".closebox").forEach(btn => {
      btn.addEventListener("click", (e) => {
        const id = btn.getAttribute("data-close");
        if(id) hideWin(id);
        e.stopPropagation();
      });
    });

    // Click window to front
    $$(".window").forEach(win => {
      win.addEventListener("pointerdown", () => setFront(win));
    });

    // Desktop icon selection
    function clearIconSelection(){
      $$(".icon").forEach(i => i.classList.remove("selected"));
    }
    desktop.addEventListener("pointerdown", (e) => {
      // click on empty desktop => deselect + close menus
      if(!e.target.closest(".icon") && !e.target.closest(".window")){
        clearIconSelection();
        closeMenus();
      }
    });

    // Icon click/double-click
    let lastClick = { id:null, t:0 };
    $$(".icon").forEach(icon => {
      icon.addEventListener("click", () => {
        clearIconSelection();
        icon.classList.add("selected");
      });
      icon.addEventListener("dblclick", () => {
        const open = icon.getAttribute("data-open");
        if(open) openThing(open);
      });
    });

    // Finder list open
    $("#finderList").addEventListener("dblclick", (e) => {
      const item = e.target.closest(".item");
      if(!item) return;
      const open = item.getAttribute("data-open");
      if(open) openThing(open);
    });

    function openThing(key){
      switch(key){
        case "finder": showWin("win-finder"); break;
        case "note": showWin("win-note"); setTimeout(()=>$("#noteArea")?.focus(), 50); break;
        case "about": showWin("win-about"); break;
        case "trash": showWin("win-trash"); break;
        default: beep();
      }
    }

    // Menus
    const menus = {
      apple: $("#dd-apple"),
      file: $("#dd-file"),
      edit: $("#dd-edit"),
      view: $("#dd-view"),
      special: $("#dd-special")
    };

    function closeMenus(){
      $$(".menu-item").forEach(m => m.classList.remove("active"));
      Object.values(menus).forEach(dd => dd.style.display = "none");
      activeMenu = null;
    }

    function openMenu(name, anchorEl){
      closeMenus();
      activeMenu = name;
      // highlight
      if(anchorEl.classList.contains("menu-item")) anchorEl.classList.add("active");
      if(name === "apple") $("#appleBtn").style.background = "#000", $("#appleBtn").style.color="#fff";
      else { $("#appleBtn").style.background = "", $("#appleBtn").style.color=""; }

      const dd = menus[name];
      if(!dd) return;

      // Position under anchor
      const r = anchorEl.getBoundingClientRect();
      dd.style.left = Math.max(6, r.left) + "px";
      dd.style.display = "block";
    }

    $("#appleBtn").addEventListener("click", (e) => {
      if(activeMenu === "apple"){ closeMenus(); $("#appleBtn").style.background=""; $("#appleBtn").style.color=""; return; }
      openMenu("apple", e.currentTarget);
      e.stopPropagation();
    });

    $$(".menu-item").forEach(mi => {
      mi.addEventListener("click", (e) => {
        const name = mi.getAttribute("data-menu");
        if(activeMenu === name){ closeMenus(); return; }
        openMenu(name, mi);
        e.stopPropagation();
      });
    });

    // click outside to close dropdowns
    window.addEventListener("pointerdown", (e) => {
      if(e.target.closest(".dropdown") || e.target.closest(".menubar")) return;
      closeMenus();
      $("#appleBtn").style.background=""; $("#appleBtn").style.color="";
    });

    // Dropdown actions
    function applyAction(act){
      switch(act){
        case "about": openThing("about"); break;
        case "openFinder": openThing("finder"); break;
        case "openNote": openThing("note"); break;
        case "closeFront":
          if(frontWin) hideWin(frontWin.id);
          else beep();
          break;
        case "scaleNormal":
          document.body.classList.remove("big","huge");
          break;
        case "scaleBig":
          document.body.classList.remove("huge");
          document.body.classList.add("big");
          break;
        case "scaleHuge":
          document.body.classList.remove("big");
          document.body.classList.add("huge");
          break;
        case "restart":
          beep();
          showWin("win-about");
          $("#win-about .wintitle").textContent = "Restart";
          $("#win-about .content").innerHTML = `
            <div>Are you sure you want to restart?</div>
            <div class="btnrow">
              <button class="btn" data-action="doRestart">Restart</button>
              <button class="btn" data-action="closeAbout">Cancel</button>
            </div>`;
          bindDialogButtons();
          break;
        case "shutdown":
          beep();
          showWin("win-about");
          $("#win-about .wintitle").textContent = "Shut Down";
          $("#win-about .content").innerHTML = `
            <div>It is now safe to turn off your computer.</div>
            <div class="btnrow">
              <button class="btn" data-action="closeAbout">OK</button>
            </div>`;
          bindDialogButtons();
          break;
        case "doRestart":
          // fake “restart” effect
          closeMenus();
          $$(".window").forEach(w => w.classList.remove("visible"));
          setTimeout(() => {
            showWin("win-finder");
            $("#win-about").classList.remove("visible");
          }, 350);
          break;
        case "closeAbout":
          // restore about content to default if it was overwritten
          restoreAbout();
          hideWin("win-about");
          break;
        case "beep":
        default:
          beep();
      }
    }

    function restoreAbout(){
      $("#win-about .wintitle").textContent = "About the Macintosh";
      $("#win-about .content").innerHTML = `
        <div style="display:flex; gap:12px; align-items:flex-start;">
          <div style="width:64px; height:64px; border:var(--winBorder) solid #000; background:#fff; display:grid; place-items:center;">
            <div style="font-weight:700; font-size: calc(26px * var(--scale));"></div>
          </div>
          <div>
            <div style="font-weight:700; margin-bottom:6px;">Macintosh</div>
            <div class="muted">System 1 UI mock (HTML/CSS/JS)</div>
            <div style="height:8px"></div>
            <div>Memory: 128K (pretend)</div>
            <div>Display: 512×342 (pretend)</div>
          </div>
        </div>
        <div class="btnrow">
          <button class="btn" data-action="closeAbout">OK</button>
        </div>
      `;
      bindDialogButtons();
    }

    function bindDialogButtons(){
      $$("#win-about [data-action]").forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const act = btn.getAttribute("data-action");
          applyAction(act);
          e.stopPropagation();
        });
      });
    }
    bindDialogButtons();

    $$(".dropdown").forEach(dd => {
      dd.addEventListener("click", (e) => {
        const row = e.target.closest(".row");
        if(!row) return;
        const act = row.getAttribute("data-action");
        if(act && act !== "sep"){
          applyAction(act);
          closeMenus();
          $("#appleBtn").style.background=""; $("#appleBtn").style.color="";
        }
      });
    });

    // keyboard shortcut: Cmd+W close front
    window.addEventListener("keydown", (e) => {
      const isMac = /Mac|iPhone|iPad|iPod/.test(navigator.platform);
      const cmd = isMac ? e.metaKey : e.ctrlKey; // Windows 上用 Ctrl 模拟
      if(cmd && (e.key === "w" || e.key === "W")){
        e.preventDefault();
        if(frontWin) hideWin(frontWin.id);
        else beep();
      }
      if(e.key === "Escape"){
        closeMenus();
        clearIconSelection();
      }
    });

    // Init: show Finder, set front
    showWin("win-finder");
    setFront($("#win-finder"));
  </script>
</body>
</html>
